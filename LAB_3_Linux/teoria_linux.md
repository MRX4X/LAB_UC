## Лабораторная работа: основы Linux (углублённая теория)

Этот файл — теоретическое дополнение к лабораторной работе по основам Linux.  
Он помогает не просто «выполнить команды», а **понять, как работает система**: файловая система, права, пользователи, процессы и текстовые утилиты.

Структура:
- **1. Общие сведения о Linux и окружении**
- **2. Файловая система и работа с файлами/каталогами**
- **3. Права доступа и атрибуты файлов**
- **4. Пользователи и группы**
- **5. Процессы и управление ими**
- **6. Текстовые утилиты, конвейеры и перенаправления**
- **7. Поиск файлов**
- **8. Рекомендации по отчёту**

---

## 1. Общие сведения о Linux и окружении

### 1.1. Что такое Linux

- **Linux (ядро)**: «сердце» ОС. Управляет:
  - памятью;
  - процессами;
  - устройствами ввода-вывода;
  - файловыми системами;
  - планированием задач.
- **Дистрибутив Linux**: ядро + набор утилит + менеджер пакетов + конфигурация по умолчанию.  
  Примеры: Ubuntu, Debian, Fedora, Arch.

Команды, которые помогают узнать информацию о системе и ядре:
- `uname -a` — подробная информация о ядре.
- `uname -r` — только версия ядра.
- `lsb_release -a` (в Ubuntu/Debian) — информация о дистрибутиве.
- `cat /etc/os-release` — стандартный способ узнать дистрибутив и версию.

### 1.2. Понятие пользователя и сессии

- **Пользователь** — сущность, под именем которой выполняются процессы и который владеет файлами.  
  Узнать, кто вы:
  - `whoami` — имя текущего пользователя.
  - `id` — UID, GID и группы.
- **Сессия** — подключение к системе (консоль, терминал, SSH).  
  Посмотреть, кто сейчас в системе:
  - `who` — кто вошёл.
  - `w` — кто вошёл + что сейчас делает.

### 1.3. Рабочий каталог и пути

- **Текущий рабочий каталог (current working directory, CWD)** — каталог, в котором вы «находитесь» в терминале.
  - `pwd` — показывает полный путь текущего каталога.
- **Домашний каталог (`$HOME`)** — личное пространство пользователя: конфигурации, документы, проекты.
  - обычно `/home/<username>`, для `root` — `/root`.
  - `cd` или `cd ~` — переход в домашний каталог.

**Типы путей:**
- **Абсолютный путь** — начинается с `/` и идёт от корня: `/home/user/lab_linux`.
- **Относительный путь** — относительно текущего каталога: `../lab_linux`.

Специальные обозначения:
- `.` — текущий каталог;
- `..` — родительский каталог.

---

## 2. Файловая система и работа с файлами/каталогами

### 2.1. Дерево каталогов Linux

В Linux всё представлено в виде **единого дерева каталогов**, начиная с корня `/`:

- `/` — корень файловой системы.
- `/bin`, `/usr/bin` — основные исполняемые программы.
- `/sbin`, `/usr/sbin` — системные утилиты (часто для администратора).
- `/etc` — конфигурационные файлы системы и служб.
- `/home` — домашние каталоги обычных пользователей.
- `/root` — домашний каталог администратора (`root`).
- `/var` — переменные данные (логи, почта, очереди, базы и т.п.).
- `/tmp` — временные файлы.
- `/dev` — специальные файлы устройств.
- `/proc` — виртуальная файловая система, предоставляет доступ к информации о процессах и ядре.
- `/sys` — информация о устройствах и ядре (sysfs).

Команды для навигации:
- `cd <путь>` — сменить текущий каталог.
- `ls` — показать содержимое:
  - `ls` — обычный список;
  - `ls -l` — подробный формат (права, владелец, размер, дата);
  - `ls -a` — показывать скрытые файлы (`.` в начале);
  - `ls -la` или `ls -al` — подробный формат + скрытые.

### 2.2. Создание каталогов и файлов

**Каталоги:**
- `mkdir lab_linux` — создать каталог.
- `mkdir -p a/b/c` — создать цепочку вложенных каталогов (если каких-то нет — создаст).

**Файлы:**
- `touch file1.txt` — создать пустой файл или обновить время последнего доступа/изменения.
- Записать текст в файл:
  - `echo "Hello, Linux!" > file2.txt` — записать строку, перезаписав файл;
  - `echo "ещё строка" >> file2.txt` — дописать в конец файла;
  - использовать текстовый редактор: `nano file2.txt`, `vim file2.txt` и т.п.

### 2.3. Копирование и перемещение

**Копирование:**
- `cp file1.txt dir1/` — скопировать файл в каталог `dir1`.
- `cp -r dir1 dir2/` — рекурсивно скопировать каталог `dir1` в `dir2`.

Флаги:
- `-r`/`-R` — рекурсивное копирование каталогов;
- `-v` — подробный вывод;
- `-i` — спрашивать подтверждение при перезаписи.

**Перемещение/переименование:**
- `mv file2.txt dir1/newfile.txt` — переместить файл в `dir1` и одновременно переименовать в `newfile.txt`.
- `mv dir1 dir2/` — переместить каталог `dir1` внутрь `dir2`.  
  Если `dir2` не существует, команда интерпретируется как **переименование** `dir1` → `dir2`.

---

## 3. Просмотр содержимого файлов

### 3.1. Базовые утилиты для просмотра

- `cat file` — вывести файл целиком.
- `less file` — постраничный просмотр (рекомендуется для больших файлов):
  - `Space`/`PgDn` — вперёд;
  - `b`/`PgUp` — назад;
  - `/строка` — поиск вперёд;
  - `q` — выход.
- `more file` — простой постраничный просмотр.

Примеры:
- `cat file1.txt` — вывести содержимое `file1.txt`.
- `cat /etc/hostname` — имя хоста системы.

### 3.2. Начало и конец файла

- `head file` — первые 10 строк.
- `head -n 5 file` — первые 5 строк.
- `tail file` — последние 10 строк.
- `tail -n 5 file` — последние 5 строк.

Просмотр лога в реальном времени:
- `tail -f /var/log/syslog` — «подписка» на файл: новые строки выводятся по мере появления.  
  Для выхода — `Ctrl+C`.

### 3.3. Поиск по содержимому (`grep`)

`grep` — утилита поиска строк по шаблону:
- `grep "root" /etc/passwd` — найти строки, содержащие `root`.
- `grep -n "root" /etc/passwd` — с номерами строк.
- `grep -i "root" /etc/passwd` — без учёта регистра.

Рекурсивный поиск:
- `grep -R "bash" /etc` — искать во всех подкаталогах `/etc`.
- Часто используемая конструкция:
  - `grep -R "bash" /etc 2>/dev/null`
    - `2>/dev/null` — перенаправить поток ошибок (stderr, дескриптор 2) в `/dev/null`, чтобы скрыть сообщения о недоступных файлах.

---

## 4. Права доступа и атрибуты файлов

### 4.1. Модель прав в Linux

Каждый файл/каталог в Linux имеет:
- **владельца (user)**;
- **группу (group)**;
- **набор прав (permissions)** для:
  - владельца (u),
  - группы (g),
  - остальных (o).

Вывод `ls -l`:

```text
-rw-r--r-- 1 user group  1234 Jan  1 12:00 file1.txt
drwxr-xr-x 2 user group  4096 Jan  1 12:00 dir1
```

Разбор первой колонки (`-rw-r--r--`):
- 1-й символ — **тип файла**:
  - `-` — обычный файл;
  - `d` — каталог;
  - `l` — символическая ссылка;
  - `c`, `b` — спец. файлы устройств.
- Далее 9 символов по 3:
  - `r` — право чтения (read);
  - `w` — право записи (write);
  - `x` — право исполнения (execute, для каталогов — «вход»/поиск).

Структура:
- `rw-` — права владельца;
- `r--` — права группы;
- `r--` — права остальных.

### 4.2. Права для каталогов

Для каталогов смысл прав:
- `r` — можно видеть список имён файлов (`ls`).
- `w` — можно создавать/удалять/переименовывать файлы внутри.
- `x` — можно «войти» в каталог (`cd`), обращаться к файлам по имени.

Каталог без `x`: видны имена, но нельзя зайти в каталог или открыть файлы.

### 4.3. Просмотр прав и атрибутов

- `ls -l lab_linux` — подробный список содержимого `lab_linux`.
- `ls -l /etc/passwd` — права, владелец, группа, размер, даты `/etc/passwd`.
- `stat file1.txt` — детальная информация: времена, права в числовом виде, inode и т.д.

### 4.4. Изменение прав (`chmod`)

Способы задания прав:

1. **Символьный формат**:
   - `chmod u+x file` — добавить владельцу (`u`) право выполнения (`+x`).
   - `chmod go-w file` — убрать право записи (`-w`) у группы (`g`) и остальных (`o`).
   - `chmod a+r file` — всем (`a` = `ugo`) добавить право чтения.

2. **Числовой (октал) формат**:

   Каждому набору прав соответствует число:
   - `r` = 4,
   - `w` = 2,
   - `x` = 1.

   Складываем:
   - `rw-` → 4 + 2 = 6,
   - `r--` → 4 = 4,
   - `r-x` → 4 + 1 = 5,
   - `rwx` → 4 + 2 + 1 = 7.

   Пример:
   - `chmod 644 file1.txt`
     - владелец: `6` → `rw-`;
     - группа: `4` → `r--`;
     - остальные: `4` → `r--`.
   - `chmod 600 file1.txt` — только владелец может читать и писать.
   - `chmod 755 script.sh` — владелец читает/пишет/исполняет, остальные — читают/исполняют.

В контексте лабораторной:
- Установить `644`:
  - `chmod 644 file1.txt`
- Добавить владельцу право на выполнение:
  - `chmod u+x file1.txt`
- Убрать у всех право на запись:
  - `chmod a-w file1.txt`

### 4.5. Изменение владельца (`chown`, `chgrp`)

- `chown` — меняет владельца и/или группу:
  - `sudo chown root file1.txt` — владелец `root`, группа не меняется;
  - `sudo chown root:root file1.txt` — владелец и группа — `root`;
  - `sudo chown -R user:group dir` — рекурсивно.
- `chgrp` — меняет только группу:
  - `sudo chgrp somegroup file1.txt`.

Пример для лабораторной:
- Сменить владельца на root:
  - `sudo chown root file1.txt`
- Вернуть владельца текущему пользователю:
  - `sudo chown "$USER" file1.txt`

---

## 5. Пользователи и группы

### 5.1. Системные файлы аккаунтов

**`/etc/passwd`** — базовая информация о пользователях:

```text
user:x:1000:1000:User Name,,,:/home/user:/bin/bash
```

Поля:
1. имя пользователя;
2. пароль (обычно `x`, реальные хэши в `/etc/shadow`);
3. UID (User ID);
4. GID (Group ID);
5. комментарий/полное имя;
6. домашний каталог;
7. оболочка (shell).

Для `root`:
- имя — `root`;
- UID = 0;
- GID = 0;
- домашний каталог `/root`;
- оболочка `/bin/bash` или `/bin/sh`.

**`/etc/group`** — информация о группах:

```text
sudo:x:27:user1,user2
```

Поля:
1. имя группы;
2. пароль группы (обычно `x` или `*`);
3. GID;
4. список пользователей, явно входящих в группу.

### 5.2. Идентификаторы и группы

Команда `id`:
- `id` — показывает UID, GID и все группы пользователя.
- `id username` — информация о конкретном пользователе.

UID и GID root:
- `id root`

Список групп пользователя:
- `groups`
- `groups username`

### 5.3. Создание и удаление пользователей

Нужен `sudo`.

- `useradd` — низкоуровневая утилита:
  - `sudo useradd -m -s /bin/bash testuser`
    - `-m` — создать домашний каталог;
    - `-s` — указать оболочку.
- `passwd` — задать/сменить пароль:
  - `sudo passwd testuser`

Удаление пользователя:
- `sudo userdel testuser` — удалить запись (домашний каталог может остаться).
- `sudo userdel -r testuser` — удалить пользователя и его домашнюю директорию.

### 5.4. Управление группами и sudo

Добавление пользователя в группу:
- `sudo usermod -aG sudo testuser`
  - `-a` — добавить;
  - `-G sudo` — в группу `sudo` (дополнительную).

Проверка:
- `groups testuser`
- или `id testuser`

Группа `sudo` (на Debian/Ubuntu) даёт право выполнять команды от имени администратора через `sudo`.

---

## 6. Процессы и управление ими

### 6.1. Что такое процесс

- **Процесс** — выполняющаяся программа.
- У каждого процесса есть:
  - PID (Process ID);
  - PPID (Parent PID);
  - UID/GID владельца;
  - состояние (running, sleeping, zombie и др.);
  - использование ресурсов (CPU, память).

### 6.2. Просмотр процессов

`ps` — снимок процессов:
- `ps` — процессы текущего терминала.
- `ps aux` — все процессы системы:
  - `a` — процессы всех пользователей, связанные с терминалами;
  - `u` — человекочитаемый формат;
  - `x` — процессы без терминала.
- `ps -ef` — аналогичный вывод в формате SysV.

Фильтрация:
- `ps aux | grep bash` — найти процессы, связанные с `bash`.

### 6.3. Интерактивный мониторинг (`top`, `htop`)

- `top`:
  - верх: загрузка CPU, память, своп;
  - низ: список процессов.
  - клавиши:
    - `q` — выход;
    - `P` — сортировка по CPU;
    - `M` — по памяти;
    - `k` — послать сигнал процессу (убить).

- `htop` (если установлен):
  - цветной интерфейс;
  - удобная навигация стрелками;
  - завершение процессов через F9.

### 6.4. Фоновые задачи и сигналы

Запуск в фоне:
- `sleep 60 &` — запуск `sleep 60` в фоне:
  - `[1] 12345` — номер задания и PID.

Управление заданиями:
- `jobs` — список фоновых задач.
- `fg %1` — вернуть задачу №1 на передний план.
- `bg %1` — возобновить задачу в фоне.

Завершение процессов:
- `kill <PID>` — послать `SIGTERM` (корректное завершение).
- `kill -9 <PID>` — `SIGKILL` (принудительное завершение).
- `kill %1` — завершить задание по номеру.

Основные сигналы:
- `SIGTERM` (15) — корректное завершение.
- `SIGKILL` (9) — немедленное завершение.
- `SIGINT` (2) — прерывание (`Ctrl+C`).
- `SIGTSTP`/`SIGSTOP` — остановка (`Ctrl+Z`).

---

## 7. Текстовые утилиты, конвейеры и перенаправления

### 7.1. Потоки stdin, stdout, stderr

- **stdin (0)** — стандартный ввод (клавиатура).
- **stdout (1)** — стандартный вывод (экран).
- **stderr (2)** — стандартный вывод ошибок.

Перенаправление:
- `>` — stdout в файл (перезаписать): `echo "Hello" > file.txt`
- `>>` — stdout в файл (дописать).
- `<` — stdin из файла: `cmd < input.txt`
- `2>` — stderr в файл.
- `2>/dev/null` — ошибки в «чёрную дыру».

Пример:
- `grep "bash" /etc 2>/dev/null` — скрыть ошибки доступа.

### 7.2. Конвейеры (pipes)

`|` — направляет stdout одной команды в stdin другой:

```bash
команда1 | команда2
```

Примеры:

1. **Количество строк в `/etc/passwd`:**
   - `cat /etc/passwd | wc -l`
   - короче: `wc -l /etc/passwd`

2. **Только файлы `.txt` в текущем каталоге:**
   - `ls -l | grep "\.txt$"`

3. **Процессы по загрузке CPU (топ-5):**
   - `ps aux | sort -rk 3 | head -n 5`

### 7.3. Часто используемые текстовые утилиты

- `wc` — подсчёты:
  - `wc -l file` — строки;
  - `wc -w file` — слова;
  - `wc -c file` — байты.
- `sort`:
  - `sort file` — лексикографически;
  - `sort -n` — числовая сортировка;
  - `sort -r` — по убыванию.
- `uniq` — удаление повторяющихся строк (обычно после `sort`).
- `cut`:
  - `cut -d: -f1 /etc/passwd` — вывести только логины.
- `tr` — заменять/удалять символы.

---

## 8. Поиск файлов (`find`)

### 8.1. Базовый синтаксис

```bash
find <каталог_начала_поиска> [условия] [действия]
```

Примеры:

1. **Все `.txt` в `~/lab_linux`:**

```bash
find ~/lab_linux -type f -name "*.txt"
```

2. **`.conf` в `/etc`, только файлы, первые 5 результатов:**

```bash
find /etc -type f -name "*.conf" 2>/dev/null | head -n 5
```

3. **Файлы, изменённые за последние 60 минут в текущем каталоге:**

```bash
find . -type f -mmin -60
```

### 8.2. Полезные опции `find`

- `-size` — по размеру (`+1M`, `-10k`).
- `-user`/`-group` — по владельцу/группе.
- `-perm` — по правам.
- `-exec <команда> {} \;` — выполнить команду над каждым найденным файлом.
- `-maxdepth` — ограничить глубину поиска.

Пример:

```bash
find . -maxdepth 1 -type f -name "*.log" -exec rm {} \;
```

---

